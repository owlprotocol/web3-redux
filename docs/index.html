<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@owlprotocol/web3-redux - v0.1.9-beta.2</title><meta name="description" content="Documentation for @owlprotocol/web3-redux - v0.1.9-beta.2"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@owlprotocol/web3-redux - v0.1.9-beta.2</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@owlprotocol/web3-redux - v0.1.9-beta.2</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#web3-redux-docs" id="web3-redux-docs" style="color: inherit; text-decoration: none;">
  <h1>Web3 Redux Docs</h1>
</a>
<p>Web3 Redux Library.</p>

<a href="#table-of-contents" id="table-of-contents" style="color: inherit; text-decoration: none;">
  <h2>Table of Contents</h2>
</a>
<ul>
<li><a href="#installing">Installing</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#interfaces">Interfaces</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#metamask">Metamask</a></li>
<li><a href="#advanced">Advanced</a></li>
</ul>

<a href="#installing" id="installing" style="color: inherit; text-decoration: none;">
  <h2>Installing</h2>
</a>
<p>Use your favorite node package manager to install <code>web3-redux</code> and the required peer dependencies. We recommend using <a href="https://github.com/pnpm/pnpm">pnpm</a> as a disk space efficient drop-in replacement of npm.</p>
<pre><code><span class="hl-0">pnpm</span><span class="hl-1"> </span><span class="hl-0">install</span><span class="hl-1"> </span><span class="hl-0">redux</span><span class="hl-1"> </span><span class="hl-0">redux</span><span class="hl-1">-</span><span class="hl-0">saga</span><span class="hl-1"> </span><span class="hl-0">react</span><span class="hl-1">-</span><span class="hl-0">redux</span><span class="hl-1"> </span><span class="hl-0">web3</span><span class="hl-1"> @</span><span class="hl-0">leovigna</span><span class="hl-1">/</span><span class="hl-0">web3</span><span class="hl-1">-</span><span class="hl-0">redux</span>
</code></pre>

<a href="#architecture" id="architecture" style="color: inherit; text-decoration: none;">
  <h2>Architecture</h2>
</a>
<p>Overview of the overall architecture of the library.</p>
<p><img src="./Flowchart.svg" alt="Flowchart.svg"></p>
<ul>
<li>All web3-redux data is stored under the <code>web3Redux</code> slice of the store as a normalized json store (State). The overall interface of the state can be found under <a href="./interfaces/State">State</a>.</li>
<li><a href="https://github.com/reduxjs/reselect">Selectors</a> for each <a href="https://github.com/redux-orm/redux-orm">redux-orm</a> model are the preferred way to then read this data.</li>
<li>Redux ORM models are meant to represent blockchain data such as <a href="./interfaces/Account">Account</a>, <a href="./interfaces/Block">Block</a>, <a href="./interfaces/Transaction">Transaction</a>, <a href="./interfaces/ContractEvent">ContractEvent</a></li>
<li>State is mutated by the dispatching of Actions. Actions can be synchronous, for simple CRUD operations on the state, or asynchronous, for network fetch operations. Async actions are handled by <a href="https://github.com/redux-saga/redux-saga">redux-saga</a> and will usually dispatched a new CRUD action after fetching data.</li>
<li>Hooks such as <code>useDispatch</code> and <code>useSelector</code>, enable Redux components to use the React Context API to read/write to the store by combinding selectors and actions.</li>
</ul>

<a href="#interfaces" id="interfaces" style="color: inherit; text-decoration: none;">
  <h2>Interfaces</h2>
</a>
<p>Here is a list of all the interfaces used by web3-redux:</p>
<ul>
<li><a href="./interfaces/Account.Account-1">Account</a></li>
<li><a href="./interfaces/Block.BlockHeader">BlockHeader</a>, <a href="./interfaces/Block.BlockTransaction">BlockTransaction</a></li>
<li><a href="./interfaces/Transaction.Transaction-1">Transaction</a></li>
<li><a href="./interfaces/Contract.Contract-1">Contract</a></li>
<li><a href="./interfaces/ContractEvent.ContractEvent-1">ContractEvent</a></li>
<li><a href="./interfaces/ContractSend.ContractSend-1">ContractSend</a></li>
<li><a href="./interfaces/EthCall.EthCall-1">EthCall</a></li>
<li><a href="./interfaces/Network.Network-1">Network</a></li>
<li><a href="./interfaces/Sync.BlockSync">BlockSync</a>, <a href="./interfaces/Sync.TransactionSync">TransactionSync</a>, <a href="./interfaces/Sync.EventSync">EventSync</a></li>
</ul>

<a href="#hooks" id="hooks" style="color: inherit; text-decoration: none;">
  <h2>Hooks</h2>
</a>
<p>To easily read/sync data, we recommend using the built-in hooks when possible to automatically combine selectors &amp; action dispatchers.</p>
<ul>
<li><a href="./modules/Account#useAccount">useAccount</a></li>
<li><a href="./modules/Block#useBlockSync">useBlockSync</a></li>
</ul>
<p><strong>TODO</strong>: Add additional hooks. (transaction, contract)</p>

<a href="#getting-started" id="getting-started" style="color: inherit; text-decoration: none;">
  <h2>Getting Started</h2>
</a>
<p>Before you begin, you might want to get familiar with some of the libraries this &quot;meta-library&quot; is built with:</p>
<ul>
<li><a href="https://reactjs.org/docs/hooks-intro.html">React Hooks</a></li>
<li><a href="https://redux.js.org/">redux</a></li>
<li><a href="https://github.com/reduxjs/reselect">reselect</a></li>
<li><a href="https://redux-orm.github.io/redux-orm/">redux-orm</a></li>
<li><a href="https://web3js.readthedocs.io/en/v1.3.0/">web3.js</a></li>
<li><a href="https://redux-saga.js.org/">redux-saga</a></li>
</ul>

<a href="#initialize-the-redux-store" id="initialize-the-redux-store" style="color: inherit; text-decoration: none;">
  <h3>Initialize the Redux Store</h3>
</a>
<p>In most situations, you will want to add web3-redux to your existing redux store. The web3Reducer MUST be stored at the <code>web3Redux</code> key in your store.</p>
<pre><code class="language-typescript"><span class="hl-2">//store.ts</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">combineReducers</span><span class="hl-1">, </span><span class="hl-0">createStore</span><span class="hl-1">, </span><span class="hl-0">applyMiddleware</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;redux&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-0">createSagaMiddleware</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;redux-saga&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">web3Reducer</span><span class="hl-1">, </span><span class="hl-0">web3Saga</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;@leovigna/web3-redux&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reducers</span><span class="hl-1"> = </span><span class="hl-7">combineReducers</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">web3Redux:</span><span class="hl-1"> </span><span class="hl-0">web3Reducer</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">sagaMiddleware</span><span class="hl-1"> = </span><span class="hl-7">createSagaMiddleware</span><span class="hl-1">();</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">store</span><span class="hl-1"> = </span><span class="hl-7">createStore</span><span class="hl-1">(</span><span class="hl-0">reducers</span><span class="hl-1">, </span><span class="hl-7">applyMiddleware</span><span class="hl-1">(</span><span class="hl-0">sagaMiddleware</span><span class="hl-1">));</span><br/><span class="hl-0">sagaMiddleware</span><span class="hl-1">.</span><span class="hl-7">run</span><span class="hl-1">(</span><span class="hl-0">web3Saga</span><span class="hl-1">);</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-3">default</span><span class="hl-1"> </span><span class="hl-0">store</span><span class="hl-1">;</span>
</code></pre>
<p>Then follow the standard <code>react-redux</code> configuration <a href="https://redux.js.org/usage/configuring-your-store">guide</a> to add a <code>Provider</code> component to wrap your entire React app in the redux context.</p>
<pre><code class="language-typescript"><span class="hl-2">//index.tsx</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-0">React</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;react&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-0">ReactDOM</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;react-dom&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">Provider</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;react-redux&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-0">App</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;./App&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-0">store</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;./store&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">ReactDOM</span><span class="hl-1">.</span><span class="hl-7">render</span><span class="hl-1">(</span><br/><span class="hl-1">    &lt;</span><span class="hl-0">React</span><span class="hl-1">.</span><span class="hl-0">StrictMode</span><span class="hl-1">&gt;</span><br/><span class="hl-1">        &lt;</span><span class="hl-0">Provider</span><span class="hl-1"> </span><span class="hl-0">store</span><span class="hl-1">={</span><span class="hl-0">store</span><span class="hl-1">}&gt;</span><br/><span class="hl-1">            &lt;</span><span class="hl-0">App</span><span class="hl-1"> /&gt;</span><br/><span class="hl-1">        &lt;/</span><span class="hl-0">Provider</span><span class="hl-1">&gt;</span><br/><span class="hl-1">    &lt;/</span><span class="hl-0">React</span><span class="hl-1">.</span><span class="hl-0">StrictMode</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">);</span>
</code></pre>

<a href="#add-a-network" id="add-a-network" style="color: inherit; text-decoration: none;">
  <h3>Add a network</h3>
</a>
<p>All entities in the <code>web3-redux</code> store are indexed by networkId. <code>web3-redux</code> let&#39;s you sync multiple networks concurrently (eg. sync Mainnet &amp; Ropsten blocks). To enable this however, you must first configure a network by adding it to the store and passing it a web3 instance.</p>
<p>A good place to do this in your React app is on app mount with a <code>useEffect</code> hook. Note that the component must be have access to the Redux context (see earlier section). Below a simple example for adding a network to the store on app mount. Here we assume the ethereum RPC is simply defined as an environment variable. For more dynamic configuration such as integration with Metamask, check out <a href="#">TBD</a>.</p>
<pre><code class="language-typescript"><span class="hl-2">//App.tsx</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">useEffect</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;react&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">useDispatch</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;react-redux&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-0">Web3</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;web3&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">Network</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;@leovigna/web3-redux&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">App</span><span class="hl-1"> = () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">dispatch</span><span class="hl-1"> = </span><span class="hl-7">useDispatch</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-7">useEffect</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">networkId</span><span class="hl-1"> = </span><span class="hl-4">&#39;1&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">web3</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-7">Web3</span><span class="hl-1">(</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">env</span><span class="hl-1">.</span><span class="hl-6">REACT_APP_RPC</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Network</span><span class="hl-1">.</span><span class="hl-7">create</span><span class="hl-1">({ </span><span class="hl-0">networkId</span><span class="hl-1">, </span><span class="hl-0">web3</span><span class="hl-1"> })); </span><span class="hl-2">//create network</span><br/><span class="hl-1">    }, []); </span><span class="hl-2">//Runs once on app mount</span><br/><span class="hl-1">    </span><span class="hl-2">//...</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#add-a-contract" id="add-a-contract" style="color: inherit; text-decoration: none;">
  <h3>Add a contract</h3>
</a>
<p>One you&#39;ve added a network, add a contract by dispatching a <code>Contract.create</code> action.
Bloew we&#39;ve extended the previous example to add a contract.</p>
<pre><code class="language-typescript"><span class="hl-2">//App.tsx</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">useEffect</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;react&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">useDispatch</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;react-redux&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-0">Web3</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;web3&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">Network</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;@leovigna/web3-redux&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">App</span><span class="hl-1"> = () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">dispatch</span><span class="hl-1"> = </span><span class="hl-7">useDispatch</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-7">useEffect</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">networkId</span><span class="hl-1"> = </span><span class="hl-4">&#39;1&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">web3</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-7">Web3</span><span class="hl-1">(</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">env</span><span class="hl-1">.</span><span class="hl-6">REACT_APP_RPC</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Network</span><span class="hl-1">.</span><span class="hl-7">create</span><span class="hl-1">({ </span><span class="hl-0">networkId</span><span class="hl-1">, </span><span class="hl-0">web3</span><span class="hl-1"> })); </span><span class="hl-2">//create network</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">address</span><span class="hl-1"> = </span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">env</span><span class="hl-1">.</span><span class="hl-6">REACT_APP_ABI</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">abi</span><span class="hl-1"> = </span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Contract</span><span class="hl-1">.</span><span class="hl-7">create</span><span class="hl-1">({ </span><span class="hl-0">networkId</span><span class="hl-1">, </span><span class="hl-0">address</span><span class="hl-1">, </span><span class="hl-0">abi</span><span class="hl-1"> })); </span><span class="hl-2">//Some smart contract abi //create contract</span><br/><span class="hl-1">    }, []); </span><span class="hl-2">//Runs once on app mount</span><br/><span class="hl-1">    </span><span class="hl-2">//...</span><br/><span class="hl-1">};</span>
</code></pre>
<p>Alternatively, if not using hooks or React in general, you can manually dispatch a eth call action and use the selector as follows:</p>
<pre><code class="language-typescript"><span class="hl-2">//Create contract</span><br/><span class="hl-0">store</span><span class="hl-1">.</span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Contract</span><span class="hl-1">.</span><span class="hl-7">create</span><span class="hl-1">({ </span><span class="hl-0">networkId</span><span class="hl-1">, </span><span class="hl-0">address</span><span class="hl-1">, </span><span class="hl-0">abi</span><span class="hl-1"> }));</span>
</code></pre>

<a href="#contract-call" id="contract-call" style="color: inherit; text-decoration: none;">
  <h3>Contract call</h3>
</a>
<p>The easiest way make a contract <a href="https://web3js.readthedocs.io/en/v1.5.2/web3-eth-contract.html#methods-mymethod-call">method call</a> is using the <code>useContractCall</code> hook. This combines dispatching a redux action and using a selector to return the updating result.</p>
<p>Here we use <code>once</code> as the sync parameter to instruct the hook to dispatch a single eth call. For more info on complex sync strategies, see the sync documentation <a href="#">TBD</a></p>
<pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">Contract</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;@leovigna/web3-redux&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">ERC20Component</span><span class="hl-1"> = ({ </span><span class="hl-0">networkId</span><span class="hl-1">, </span><span class="hl-0">address</span><span class="hl-1">, </span><span class="hl-0">account</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">//Make contract call</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">balanceOf</span><span class="hl-1">] = </span><span class="hl-0">Contract</span><span class="hl-1">.</span><span class="hl-7">useContractCall</span><span class="hl-1">(</span><span class="hl-0">networkId</span><span class="hl-1">, </span><span class="hl-0">address</span><span class="hl-1">, </span><span class="hl-4">&#39;balanceOf&#39;</span><span class="hl-1">, [</span><span class="hl-0">account</span><span class="hl-1">], { </span><span class="hl-0">sync:</span><span class="hl-1"> </span><span class="hl-4">&#39;once&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-2">//...</span><br/><span class="hl-1">};</span>
</code></pre>
<p>Alternative in plain Typescript:</p>
<pre><code class="language-typescript"><span class="hl-2">//Make contract call</span><br/><span class="hl-0">store</span><span class="hl-1">.</span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Contract</span><span class="hl-1">.</span><span class="hl-7">call</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">networkId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">address</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">method:</span><span class="hl-1"> </span><span class="hl-4">&#39;balanceOf&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">args:</span><span class="hl-1"> [</span><span class="hl-0">account</span><span class="hl-1">],</span><br/><span class="hl-1">}));</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">balance</span><span class="hl-1"> = </span><span class="hl-0">Contract</span><span class="hl-1">.</span><span class="hl-7">selectContractCall</span><span class="hl-1">(</span><span class="hl-0">state</span><span class="hl-1">, {</span><span class="hl-0">networkId</span><span class="hl-1">, </span><span class="hl-0">address</span><span class="hl-1"> }, </span><span class="hl-4">&#39;balanceOf&#39;</span><span class="hl-1">, { </span><span class="hl-0">args:</span><span class="hl-1"> [</span><span class="hl-0">account</span><span class="hl-1">] } ]})</span>
</code></pre>

<a href="#contract-event-subscription" id="contract-event-subscription" style="color: inherit; text-decoration: none;">
  <h3>Contract Event subscription</h3>
</a>
<p>Another way to sync data from your smart contract is to use <a href="https://web3js.readthedocs.io/en/v1.5.2/web3-eth-contract.html#contract-events">event subscriptions</a>. The <code>useEvents</code> hook is helpful for this.
Here we enable <code>sync</code> and <code>past</code> to both get new updates (using websocket subscription) and past events (using <a href="https://web3js.readthedocs.io/en/v1.5.2/web3-eth-contract.html#getpastevents">getPastEvents</a>). Note that getting past events can be an expensive operation, and we recommend disabling or limiting (with block range parameters) the fetching of old events when possible.
The <code>web-redux</code> event subscription hook is configured to automatically start/stop the correct subscription if any relevant params of the hook change. Alternatively, you can use the <code>subscribe()/unsubscribe()</code> handlers for more granular control such as handling user interactions.</p>
<pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">Contract</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;@leovigna/web3-redux&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">ERC20Component</span><span class="hl-1"> = ({ </span><span class="hl-0">networkId</span><span class="hl-1">, </span><span class="hl-0">address</span><span class="hl-1">, </span><span class="hl-0">account</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">// Sync events</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">transfers</span><span class="hl-1">, { </span><span class="hl-6">subscribe</span><span class="hl-1">, </span><span class="hl-6">unsubsribe</span><span class="hl-1"> }] = </span><span class="hl-0">Contract</span><span class="hl-1">.</span><span class="hl-7">useEvents</span><span class="hl-1">(</span><span class="hl-0">networkId</span><span class="hl-1">, </span><span class="hl-0">address</span><span class="hl-1">, </span><span class="hl-4">&#39;Transfer&#39;</span><span class="hl-1">, [</span><span class="hl-0">account</span><span class="hl-1">], {</span><br/><span class="hl-1">        </span><span class="hl-0">sync:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">past:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">fromBlock:</span><span class="hl-1"> </span><span class="hl-4">&#39;earliest&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">toBlock:</span><span class="hl-1"> </span><span class="hl-4">&#39;latest&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-2">//...</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#block-subscription" id="block-subscription" style="color: inherit; text-decoration: none;">
  <h3>Block subscription</h3>
</a>
<p>To sync with on-chain events, it&#39;s a good idea to start a block subscription as it can be used as a reference point to keep data fresh. This is recommended but not required as some apps might use a different refresh mechanism.
The <code>web3-redux</code> block subscription hook is configured to automatically start/stop the correct subscription if the <code>networkId</code> parameter changes. Alternatively, you can use the <code>subscribe()/unsubscribe()</code> handlers for more granular control such as handling user interactions.</p>
<pre><code class="language-typescript"><span class="hl-2">//Blocks.tsx</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">Block</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;@leovigna/web3-redux&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">BlocksComponent</span><span class="hl-1"> = ({ </span><span class="hl-0">networkId</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">blocks</span><span class="hl-1">, { </span><span class="hl-6">subscribe</span><span class="hl-1">, </span><span class="hl-6">unsubsribe</span><span class="hl-1"> }] = </span><span class="hl-0">Block</span><span class="hl-1">.</span><span class="hl-7">useBlockSync</span><span class="hl-1">(</span><span class="hl-0">networkId</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>
<p>Alternatively, if not using hooks or React in general, you can manually dispatch a block sync action and use the selector as follows:</p>
<pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-0">Block</span><span class="hl-1">, </span><span class="hl-0">Network</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-4">&#39;@leovigna/web3-redux&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">store</span><span class="hl-1">.</span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Block</span><span class="hl-1">.</span><span class="hl-7">subscribe</span><span class="hl-1">({ </span><span class="hl-0">networkId:</span><span class="hl-1"> </span><span class="hl-4">&#39;1&#39;</span><span class="hl-1"> }));</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">blocks</span><span class="hl-1"> = </span><span class="hl-0">Network</span><span class="hl-1">.</span><span class="hl-7">selectBlocks</span><span class="hl-1">(</span><span class="hl-0">store</span><span class="hl-1">.</span><span class="hl-7">getState</span><span class="hl-1">());</span>
</code></pre>

<a href="#contract-call-sync" id="contract-call-sync" style="color: inherit; text-decoration: none;">
  <h2>Contract Call Sync</h2>
</a>
<p><code>web3-redux</code> offers enhanced customizability of contract call syncing to avoid unecessary rpc calls. Contract call syncing is achieved by refreshing contract calls based on a set of parameters. To initiate contract call syncing, one must first dispatch a ContractCallAction.</p>
<p>There are 4 types of contract call syncing:</p>
<ul>
<li><code>once</code>: Call contract method once</li>
<li><code>Block</code>: Call contract and refresh every block.
<code>Evnet</code>: (TDB)</li>
<li><code>Transaction</code>: Call contract and refresh every time a block includes a transaction to the contract.</li>
</ul>
<p>Note: Both block sync and transaction sync require an existing block subscription to be first created.</p>
<p>By default we use Transaction syncing. See <a href="#custom-contract-call-syncing">Advanced/Optimising Contract Call Sync</a> for more info.</p>

<a href="#sync-middleware" id="sync-middleware" style="color: inherit; text-decoration: none;">
  <h2>Sync Middleware</h2>
</a>
<p><code>web3-redux</code> comes with a built-in <code>Sync</code> data model which serves as a form of dynamic middleware that can be added, removed, and customized. There are three types of syncs, <code>BlockSync</code>, <code>EventSync</code>, and <code>TransactionSync</code> which each can trigger actions upon receiving updates to a new block, new event, or new transaction.</p>
<p>All three inherit from <code>BaseSync</code> which defines a set of <code>actions</code> to dispatch if the <code>filter</code> predicate matches the update. Sync middleware can be useful when looking to dispatch your own custom Redux action as a result of some blockchain update. They are also used as the building blocks for the Contract Call sync.</p>
<p><b>Block Sync</b></p>
<p>This middleware listens for <code>Block/CREATE</code> actions, and if a block matches its <code>filter</code> predicate, will dispatch its <code>actions</code>. The following example triggers every 5 blocks:</p>
<pre><code class="language-typescript"><span class="hl-0">store</span><span class="hl-1">.</span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Sync</span><span class="hl-1">.</span><span class="hl-7">create</span><span class="hl-1">({ </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-4">&#39;1&#39;</span><span class="hl-1">, </span><span class="hl-0">type:</span><span class="hl-1"> </span><span class="hl-4">&#39;Block&#39;</span><span class="hl-1">, </span><span class="hl-7">filter</span><span class="hl-0">:</span><span class="hl-1"> (</span><span class="hl-0">block</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">block</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1"> % </span><span class="hl-8">5</span><span class="hl-1"> == </span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-0">actions</span><span class="hl-1"> }));</span>
</code></pre>
<p><b>Event Sync</b></p>
<p>This middleware listens for <code>ContractEvent/CREATE</code> actions, and if an event matches its <code>filter</code> predicate, will dispatch its <code>actions</code>. The following example filters for events named <code>Transfer</code>:</p>
<pre><code class="language-typescript"><span class="hl-0">store</span><span class="hl-1">.</span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Sync</span><span class="hl-1">.</span><span class="hl-7">create</span><span class="hl-1">({ </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-4">&#39;1&#39;</span><span class="hl-1">, </span><span class="hl-0">type:</span><span class="hl-1"> </span><span class="hl-4">&#39;Event&#39;</span><span class="hl-1">, </span><span class="hl-7">filter</span><span class="hl-0">:</span><span class="hl-1"> (</span><span class="hl-0">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">event</span><span class="hl-1">.</span><span class="hl-0">name</span><span class="hl-1"> == </span><span class="hl-4">&#39;Transfer&#39;</span><span class="hl-1">, </span><span class="hl-0">actions</span><span class="hl-1"> }));</span>
</code></pre>
<p><b>Transaction Sync</b></p>
<p>This middleware listens for <code>Transaction/CREATE</code> actions, and if an event matches its <code>filter</code> predicate, will dispatch its <code>actions</code>. The following example filters for tranaction from a particular sender:</p>
<pre><code class="language-typescript"><span class="hl-0">store</span><span class="hl-1">.</span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Sync</span><span class="hl-1">.</span><span class="hl-7">create</span><span class="hl-1">({ </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-4">&#39;1&#39;</span><span class="hl-1">, </span><span class="hl-0">type:</span><span class="hl-1"> </span><span class="hl-4">&#39;Transaction&#39;</span><span class="hl-1">, </span><span class="hl-7">filter</span><span class="hl-0">:</span><span class="hl-1"> (</span><span class="hl-0">tx</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">tx</span><span class="hl-1">.</span><span class="hl-0">from</span><span class="hl-1"> == </span><span class="hl-0">address</span><span class="hl-1">, </span><span class="hl-0">actions</span><span class="hl-1"> }));</span>
</code></pre>

<a href="#metamask" id="metamask" style="color: inherit; text-decoration: none;">
  <h2>Metamask</h2>
</a>
<p>See <a href="#manual">Manual Network Initialization</a> for more detail.
Metamask can cause issues as the injected Web3 instance is mutable and changes as users change networks. To mitigate this, Networks can be initialized with 2 web3 instances, one for read-only calls (eg. Infura) and one for wallet signed send transactions (Metamask). This way, subcriptions and call syncs can continue to work even if a user changes networks.</p>
<p>Override the optional <code>web3Sender</code> parameter when initializing the Network and set it to the injected Web3 instance. The regular read-only web3 instance should</p>
<pre><code class="language-typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">web3Sender</span><span class="hl-1"> = </span><span class="hl-0">window</span><span class="hl-1">.</span><span class="hl-0">web3</span><span class="hl-1">; </span><span class="hl-2">//Metamask wallet, used for send transactions</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">web3ReadOnly</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-7">Web3</span><span class="hl-1">(</span><span class="hl-4">&#39;ws://localhost:8545&#39;</span><span class="hl-1">); </span><span class="hl-2">//Used for calls/subscriptions</span><br/><span class="hl-0">store</span><span class="hl-1">.</span><span class="hl-7">dispatch</span><span class="hl-1">(</span><span class="hl-0">Network</span><span class="hl-1">.</span><span class="hl-7">create</span><span class="hl-1">({ </span><span class="hl-0">networkId:</span><span class="hl-1"> </span><span class="hl-4">&#39;1&#39;</span><span class="hl-1">, </span><span class="hl-0">web3:</span><span class="hl-1"> </span><span class="hl-0">web3ReadOnly</span><span class="hl-1">, </span><span class="hl-0">web3Sender</span><span class="hl-1"> }));</span>
</code></pre>

<a href="#advanced" id="advanced" style="color: inherit; text-decoration: none;">
  <h2>Advanced</h2>
</a>

<a href="#optimizing-contract-call-sync" id="optimizing-contract-call-sync" style="color: inherit; text-decoration: none;">
  <h3>Optimizing Contract Call Sync</h3>
</a>
<p>By default, contracts use Transaction syncing but this can be customized for each specific contract call. This is can be a sub-optimal or even incorrect sync strategy.</p>
<p>Transaction syncing can be sub-optimal if a call&#39;s return value never changes. For example, an ERC19 token&#39;s name or symbol. In this case simply disable syncing with <code>sync: false</code>.</p>
<p>Transaction syncing assumes that the contract call values are only dependent on your contract&#39;s state and that this state is only changed by direct transactions to your contract. The basic logic for Transaction syncing is as follows: For each transaction in a new block, update contract call if <code>tx.to == contract.address</code>.
Examples of cases where this assumption might be incorrect include:</p>
<ul>
<li>Contract call return value depends on block number</li>
<li>Contract state can be changed by a call to some proxy contract</li>
</ul>
<p>In these cases we recommend switching to Block syncing, which will poll the contract call at every block. For even better optimization, it might be interesting in some cases to use a custom block or transaction sync.</p>

<a href="#custom-contract-call-sync" id="custom-contract-call-sync" style="color: inherit; text-decoration: none;">
  <h3>Custom Contract Call Sync</h3>
</a>
<p>The interface of ContractCallBlockSync and ContractCallTransactionSync use a filter function returning whether a contract call should update. Customizing the filter function can help you create more optimized syncing depending on your use case.</p>
<pre><code class="language-typescript"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-9">ContractCallBlockSync</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">type</span><span class="hl-1">: </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-6">CALL_BLOCK_SYNC</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">filter</span><span class="hl-1">: (</span><span class="hl-0">block</span><span class="hl-1">: </span><span class="hl-9">BlockHeader</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-9">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-9">ContractCallTransactionSync</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">type</span><span class="hl-1">: </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-6">CALL_TRANSACTION_SYNC</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">filter</span><span class="hl-1">: (</span><span class="hl-0">transaction</span><span class="hl-1">: </span><span class="hl-9">Transaction</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-9">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Example sync strategies:</p>
<ul>
<li>Sync every 4 blocks: <code>(block) =&gt; block.number % 5 == 0</code></li>
<li>Sync for transactions to contract or proxy: <code>(tx) =&gt; tx.to === contract.address || tx.to === proxy.address</code></li>
</ul>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li><li class=" tsd-kind-namespace"><a href="modules/Block.html">Block</a></li><li class=" tsd-kind-namespace"><a href="modules/Config.html">Config</a></li><li class=" tsd-kind-namespace"><a href="modules/Contract.html">Contract</a></li><li class=" tsd-kind-namespace"><a href="modules/ContractEvent.html">Contract<wbr/>Event</a></li><li class=" tsd-kind-namespace"><a href="modules/ContractSend.html">Contract<wbr/>Send</a></li><li class=" tsd-kind-namespace"><a href="modules/EthCall.html">Eth<wbr/>Call</a></li><li class=" tsd-kind-namespace"><a href="modules/Network.html">Network</a></li><li class=" tsd-kind-namespace"><a href="modules/Sync.html">Sync</a></li><li class=" tsd-kind-namespace"><a href="modules/Transaction.html">Transaction</a></li><li class=" tsd-kind-namespace"><a href="modules/_4Byte.html">_4<wbr/>Byte</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-interface"><a href="interfaces/State.html" class="tsd-kind-icon">State</a></li><li class="tsd-kind-function"><a href="modules.html#rootReducer" class="tsd-kind-icon">root<wbr/>Reducer</a></li><li class="tsd-kind-function"><a href="modules.html#rootSaga" class="tsd-kind-icon">root<wbr/>Saga</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>